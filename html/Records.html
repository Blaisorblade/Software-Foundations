<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>Records: Adding Records to STLC</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Records<span class="subtitle">Adding Records to STLC</span></h1>

<div class="code code-tight">
</div>

<div class="doc">

</div>
<div class="code code-tight">

<br/>
<span class="comment">(*&nbsp;$Date:&nbsp;2011-03-21&nbsp;13:05:05&nbsp;-0400&nbsp;(Mon,&nbsp;21&nbsp;Mar&nbsp;2011)&nbsp;$&nbsp;*)</span><br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Export</span> <a class="idref" href="Stlc.html#"><span class="id" type="library">Stlc</span></a>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="library">Relations</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab587"></a><h1 class="section">Adding Records</h1>

<div class="paragraph"> </div>

 We saw in <span class="inlinecode"><span class="id" type="var">MoreStlc.v</span></span> how records can be treated as syntactic
    sugar for nested uses of products.  This is fine for simple
    examples, but the encoding is informal (in reality, if we really
    treated records this way, it would be carried out in the parser,
    which we are eliding here), and anyway it is not very efficient.
    So it is also interesting to see how records can be treated as
    first-class citizens of the language. 

<div class="paragraph"> </div>

    Recall the informal definitions we gave before: 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

    Syntax:
<pre>
       t ::=                          Terms:
           | ...
           | {i1=t1, ..., in=tn}         record 
           | t.i                         projection

       v ::=                          Values:
           | ...
           | {i1=v1, ..., in=vn}         record value

       T ::=                          Types:
           | ...
           | {i1:T1, ..., in:Tn}         record type
</pre>
   Reduction:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">ti&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;ti'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ST_Rcd)</td>
  <td class="infrulenamecol" rowspan="3">
    &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">{i1=v1,&nbsp;...,&nbsp;im=vm,&nbsp;in=tn,&nbsp;...}&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;{i1=v1,&nbsp;...,&nbsp;im=vm,&nbsp;in=tn',&nbsp;...}</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t1&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;t1'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Proj1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">t1.i&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;t1'.i</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_ProjRcd) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">{...,&nbsp;i=vi,&nbsp;...}.i&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;vi</td>
  <td></td>
</td>
</table></center>   Typing:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span style="font-family: serif; font-size:85%;">&Gamma;</span>&nbsp;<span style="font-family: arial;">&#8866;</span>&nbsp;t1&nbsp;:&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: serif; font-size:85%;">&Gamma;</span>&nbsp;<span style="font-family: arial;">&#8866;</span>&nbsp;tn&nbsp;:&nbsp;Tn</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Rcd) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style="font-family: serif; font-size:85%;">&Gamma;</span>&nbsp;<span style="font-family: arial;">&#8866;</span>&nbsp;{i1=t1,&nbsp;...,&nbsp;in=tn}&nbsp;:&nbsp;{i1:T1,&nbsp;...,&nbsp;in:Tn}</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span style="font-family: serif; font-size:85%;">&Gamma;</span>&nbsp;<span style="font-family: arial;">&#8866;</span>&nbsp;t&nbsp;:&nbsp;{...,&nbsp;i:Ti,&nbsp;...}</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Proj) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style="font-family: serif; font-size:85%;">&Gamma;</span>&nbsp;<span style="font-family: arial;">&#8866;</span>&nbsp;t.i&nbsp;:&nbsp;Ti</td>
  <td></td>
</td>
</table></center>
<div class="paragraph"> </div>

<a name="lab588"></a><h1 class="section">Formalizing Records</h1>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Module</span> <a name="STLCExtendedRecords"><span class="id" type="module">STLCExtendedRecords</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab589"></a><h3 class="section">Syntax and Operational Semantics</h3>

<div class="paragraph"> </div>

 The most obvious way to formalize the syntax of record types would
    be this: 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Module</span> <a name="STLCExtendedRecords.FirstTry"><span class="id" type="module">FirstTry</span></a>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <a name="STLCExtendedRecords.FirstTry.alist"><span class="id" type="definition">alist</span></a> (<span class="id" type="var">X</span> : <span class="id" type="keyword">Type</span>) := <span class="id" type="inductive">list</span> (<a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> * <span class="id" type="var">X</span>).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <a name="STLCExtendedRecords.FirstTry.ty"><span class="id" type="inductive">ty</span></a> : <span class="id" type="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.FirstTry.ty_base"><span class="id" type="constructor">ty_base</span></a>     : <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.FirstTry.ty_arrow"><span class="id" type="constructor">ty_arrow</span></a>    : <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.FirstTry.ty_rcd"><span class="id" type="constructor">ty_rcd</span></a>      : (<a class="idref" href="Records.html#STLCExtendedRecords.FirstTry.alist"><span class="id" type="definition">alist</span></a> <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a>) <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a>.<br/>

<br/>
</div>

<div class="doc">
Unfortunately, we encounter here a limitation in Coq: this type
    does not automatically give us the induction principle we expect
 the induction hypothesis in the <span class="inlinecode"><span class="id" type="var">ty_rcd</span></span> case doesn't give us
    any information about the <span class="inlinecode"><span class="id" type="var">ty</span></span> elements of the list, making it
    useless for the proofs we want to do.  
</div>
<div class="code code-tight">

<br/>
<span class="comment">(*&nbsp;Check&nbsp;ty_ind.&nbsp;<br/>
&nbsp;&nbsp;&nbsp;====&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ty_ind&nbsp;:&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;P&nbsp;:&nbsp;ty&nbsp;-&gt;&nbsp;Prop,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(forall&nbsp;i&nbsp;:&nbsp;id,&nbsp;P&nbsp;(ty_base&nbsp;i))&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(forall&nbsp;t&nbsp;:&nbsp;ty,&nbsp;P&nbsp;t&nbsp;-&gt;&nbsp;forall&nbsp;t0&nbsp;:&nbsp;ty,&nbsp;P&nbsp;t0&nbsp;-&gt;&nbsp;P&nbsp;(ty_arrow&nbsp;t&nbsp;t0))&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(forall&nbsp;a&nbsp;:&nbsp;alist&nbsp;ty,&nbsp;P&nbsp;(ty_rcd&nbsp;a))&nbsp;-&gt;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;???&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;t&nbsp;:&nbsp;ty,&nbsp;P&nbsp;t<br/>
*)</span><br/>

<br/>
<span class="id" type="keyword">End</span> <a class="idref" href="Records.html#FirstTry"><span class="id" type="module">FirstTry</span></a>.<br/>

<br/>
</div>

<div class="doc">
It is possible to get a better induction principle out of Coq, but
    the details of how this is done are not very pretty, and it is not
    as intuitive to use as the ones Coq generates automatically for
    simple <span class="inlinecode"><span class="id" type="keyword">Inductive</span></span> definitions.

<div class="paragraph"> </div>

    Fortunately, there is a different way of formalizing records that
    is, in some ways, even simpler and more natural: instead of using
    the existing <span class="inlinecode"><span class="id" type="var">list</span></span> type, we can essentially include its
    constructors ("nil" and "cons") in the syntax of types. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="STLCExtendedRecords.ty"><span class="id" type="inductive">ty</span></a> : <span class="id" type="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ty_base"><span class="id" type="constructor">ty_base</span></a> : <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ty_arrow"><span class="id" type="constructor">ty_arrow</span></a> : <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ty_rnil"><span class="id" type="constructor">ty_rnil</span></a> : <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ty_rcons"><span class="id" type="constructor">ty_rcons</span></a> : <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#ty"><span class="id" type="inductive">ty</span></a>.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "ty_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ty_base" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ty_arrow"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ty_rnil" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ty_rcons" ].<br/>

<br/>
</div>

<div class="doc">
Similarly, at the level of terms, we have constructors <span class="inlinecode"><span class="id" type="var">tm_rnil</span></span>
 the empty record &mdash; and <span class="inlinecode"><span class="id" type="var">tm_rcons</span></span>, which adds a single field to
    the front of a list of fields. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="STLCExtendedRecords.tm"><span class="id" type="inductive">tm</span></a> : <span class="id" type="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.tm_var"><span class="id" type="constructor">tm_var</span></a> : <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#tm"><span class="id" type="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> : <a class="idref" href="Records.html#tm"><span class="id" type="inductive">tm</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#tm"><span class="id" type="inductive">tm</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#tm"><span class="id" type="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.tm_abs"><span class="id" type="constructor">tm_abs</span></a> : <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" type="inductive">ty</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#tm"><span class="id" type="inductive">tm</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#tm"><span class="id" type="inductive">tm</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;records&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.tm_proj"><span class="id" type="constructor">tm_proj</span></a> : <a class="idref" href="Records.html#tm"><span class="id" type="inductive">tm</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#tm"><span class="id" type="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.tm_rnil"><span class="id" type="constructor">tm_rnil</span></a> :  <a class="idref" href="Records.html#tm"><span class="id" type="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> : <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#tm"><span class="id" type="inductive">tm</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#tm"><span class="id" type="inductive">tm</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#tm"><span class="id" type="inductive">tm</span></a>.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "tm_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tm_var" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tm_app" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tm_abs"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tm_proj" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tm_rnil" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tm_rcons" ].<br/>

<br/>
</div>

<div class="doc">
Some variables, for examples... 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Notation</span> <a name="STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a> := (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 0).<br/>
<span class="id" type="keyword">Notation</span> <a name="STLCExtendedRecords.f"><span class="id" type="abbreviation">f</span></a> := (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 1).<br/>
<span class="id" type="keyword">Notation</span> <a name="STLCExtendedRecords.g"><span class="id" type="abbreviation">g</span></a> := (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 2).<br/>
<span class="id" type="keyword">Notation</span> <a name="STLCExtendedRecords.l"><span class="id" type="abbreviation">l</span></a> := (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 3).<br/>
<span class="id" type="keyword">Notation</span> <a name="STLCExtendedRecords.A"><span class="id" type="abbreviation">A</span></a> := (<a class="idref" href="Records.html#STLCExtendedRecords.ty_base"><span class="id" type="constructor">ty_base</span></a> (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 4)).<br/>
<span class="id" type="keyword">Notation</span> <a name="STLCExtendedRecords.B"><span class="id" type="abbreviation">B</span></a> := (<a class="idref" href="Records.html#STLCExtendedRecords.ty_base"><span class="id" type="constructor">ty_base</span></a> (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 5)).<br/>
<span class="id" type="keyword">Notation</span> <a name="STLCExtendedRecords.k"><span class="id" type="abbreviation">k</span></a> := (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 6).<br/>
<span class="id" type="keyword">Notation</span> <a name="STLCExtendedRecords.i1"><span class="id" type="abbreviation">i1</span></a> := (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 7).<br/>
<span class="id" type="keyword">Notation</span> <a name="STLCExtendedRecords.i2"><span class="id" type="abbreviation">i2</span></a> := (<a class="idref" href="SfLib.html#Id"><span class="id" type="constructor">Id</span></a> 8).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode">{</span> <span class="inlinecode"><span class="id" type="var">i1</span>:<span class="id" type="var">A</span></span> <span class="inlinecode">}</span> 
</div>
<div class="code code-tight">

<br/>
<span class="comment">(*&nbsp;Check&nbsp;(ty_rcons&nbsp;i1&nbsp;A&nbsp;ty_rnil).&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode">{</span> <span class="inlinecode"><span class="id" type="var">i1</span>:<span class="id" type="var">A</span><span style="font-family: arial;">&rarr;</span><span class="id" type="var">B</span>,</span> <span class="inlinecode"><span class="id" type="var">i2</span>:<span class="id" type="var">A</span></span> <span class="inlinecode">}</span> 
</div>
<div class="code code-tight">

<br/>
<span class="comment">(*&nbsp;Check&nbsp;(ty_rcons&nbsp;i1&nbsp;(ty_arrow&nbsp;A&nbsp;B)&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ty_rcons&nbsp;i2&nbsp;A&nbsp;ty_rnil)).&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
<a name="lab590"></a><h3 class="section">Well-Formedness</h3>

<div class="paragraph"> </div>

 Generalizing our abstract syntax for records (from lists to the
    nil/cons presentation) introduces the possibility of writing
    strange types like this 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <a name="STLCExtendedRecords.weird_type"><span class="id" type="definition">weird_type</span></a> := <a class="idref" href="Records.html#STLCExtendedRecords.ty_rcons"><span class="id" type="constructor">ty_rcons</span></a> <a class="idref" href="Imp.html#X"><span class="id" type="definition">X</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" type="abbreviation">A</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" type="abbreviation">B</span></a>.<br/>

<br/>
</div>

<div class="doc">
where the "tail" of a record type is not actually a record type! 
<div class="paragraph"> </div>

 We'll structure our typing judgement so that no ill-formed types
    like <span class="inlinecode"><span class="id" type="var">weird_type</span></span> are assigned to terms.  To support this, we
    define <span class="inlinecode"><span class="id" type="var">record_ty</span></span> and <span class="inlinecode"><span class="id" type="var">record_tm</span></span>, which identify record types
    and terms, and <span class="inlinecode"><span class="id" type="var">well_formed_ty</span></span> which rules out the ill-formed
    types. 
<div class="paragraph"> </div>

 First, a type is a record type if it is built with just <span class="inlinecode"><span class="id" type="var">ty_rnil</span></span>
    and <span class="inlinecode"><span class="id" type="var">ty_rcons</span></span> at the outermost level. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="STLCExtendedRecords.record_ty"><span class="id" type="inductive">record_ty</span></a> : <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" type="inductive">ty</span></a> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.rty_nil"><span class="id" type="constructor">rty_nil</span></a> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#record_ty"><span class="id" type="inductive">record_ty</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.ty_rnil"><span class="id" type="constructor">ty_rnil</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.rty_cons"><span class="id" type="constructor">rty_cons</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">i</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#record_ty"><span class="id" type="inductive">record_ty</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.ty_rcons"><span class="id" type="constructor">ty_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span>).<br/>

<br/>
</div>

<div class="doc">
Similarly, a term is a record term if it is built with <span class="inlinecode"><span class="id" type="var">tm_rnil</span></span>
    and <span class="inlinecode"><span class="id" type="var">tm_rcons</span></span> 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="STLCExtendedRecords.record_tm"><span class="id" type="inductive">record_tm</span></a> : <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" type="inductive">tm</span></a> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.rtm_nil"><span class="id" type="constructor">rtm_nil</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#record_tm"><span class="id" type="inductive">record_tm</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.tm_rnil"><span class="id" type="constructor">tm_rnil</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.rtm_cons"><span class="id" type="constructor">rtm_cons</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">i</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#record_tm"><span class="id" type="inductive">record_tm</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>

<br/>
</div>

<div class="doc">
Note that <span class="inlinecode"><span class="id" type="var">record_ty</span></span> and <span class="inlinecode"><span class="id" type="var">record_tm</span></span> are not recursive &mdash; they
    just check the outermost constructor.  The <span class="inlinecode"><span class="id" type="var">well_formed_ty</span></span>
    property, on the other hand, verifies that the whole type is well
    formed in the sense that the tail of every record (the second
    argument to <span class="inlinecode"><span class="id" type="var">ty_rcons</span></span>) is a record.

<div class="paragraph"> </div>

    Of course, we should also be concerned about ill-formed terms, not
    just types; but typechecking can rules those out without the help
    of an extra <span class="inlinecode"><span class="id" type="var">well_formed_tm</span></span> definition because it already
    examines the structure of terms.   LATER : should they fill in part of this as an exercise?  We
    didn't give rules for it above 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="STLCExtendedRecords.well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> : <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" type="inductive">ty</span></a> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.wfty_base"><span class="id" type="constructor">wfty_base</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.ty_base"><span class="id" type="constructor">ty_base</span></a> <span class="id" type="var">i</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.wfty_arrow"><span class="id" type="constructor">wfty_arrow</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> <span class="id" type="var">T1</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> <span class="id" type="var">T2</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.ty_arrow"><span class="id" type="constructor">ty_arrow</span></a> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.wfty_rnil"><span class="id" type="constructor">wfty_rnil</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.ty_rnil"><span class="id" type="constructor">ty_rnil</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.wfty_rcons"><span class="id" type="constructor">wfty_rcons</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">i</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> <span class="id" type="var">T1</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> <span class="id" type="var">T2</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.record_ty"><span class="id" type="inductive">record_ty</span></a> <span class="id" type="var">T2</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.ty_rcons"><span class="id" type="constructor">ty_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span>).<br/>

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="var">Constructors</span> <span class="id" type="var">record_ty</span> <span class="id" type="var">record_tm</span> <span class="id" type="var">well_formed_ty</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab591"></a><h3 class="section">Substitution</h3>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="STLCExtendedRecords.subst"><span class="id" type="definition">subst</span></a> (<span class="id" type="var">x</span>:<a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a>) (<span class="id" type="var">s</span>:<a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" type="inductive">tm</span></a>) (<span class="id" type="var">t</span>:<a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" type="inductive">tm</span></a>) : <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" type="inductive">tm</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.tm_var"><span class="id" type="constructor">tm_var</span></a> <span class="id" type="var">y</span> =&gt; <span class="id" type="keyword">if</span> <a class="idref" href="SfLib.html#beq_id"><span class="id" type="definition">beq_id</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">then</span> <span class="id" type="var">s</span> <span class="id" type="keyword">else</span> <span class="id" type="var">t</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.tm_abs"><span class="id" type="constructor">tm_abs</span></a> <span class="id" type="var">y</span> <span class="id" type="var">T</span> <span class="id" type="var">t1</span> =&gt;  <a class="idref" href="Records.html#STLCExtendedRecords.tm_abs"><span class="id" type="constructor">tm_abs</span></a> <span class="id" type="var">y</span> <span class="id" type="var">T</span> (<span class="id" type="keyword">if</span> <a class="idref" href="SfLib.html#beq_id"><span class="id" type="definition">beq_id</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">then</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">else</span> (<a class="idref" href="Records.html#subst"><span class="id" type="definition">subst</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> <span class="id" type="var">t1</span>))<br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> =&gt; <a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> (<a class="idref" href="Records.html#subst"><span class="id" type="definition">subst</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> <span class="id" type="var">t1</span>) (<a class="idref" href="Records.html#subst"><span class="id" type="definition">subst</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> <span class="id" type="var">t2</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.tm_proj"><span class="id" type="constructor">tm_proj</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">i</span> =&gt; <a class="idref" href="Records.html#STLCExtendedRecords.tm_proj"><span class="id" type="constructor">tm_proj</span></a> (<a class="idref" href="Records.html#subst"><span class="id" type="definition">subst</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> <span class="id" type="var">t1</span>) <span class="id" type="var">i</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.tm_rnil"><span class="id" type="constructor">tm_rnil</span></a> =&gt; <a class="idref" href="Records.html#STLCExtendedRecords.tm_rnil"><span class="id" type="constructor">tm_rnil</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">t1</span> <span class="id" type="var">tr1</span> =&gt; <a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> (<a class="idref" href="Records.html#subst"><span class="id" type="definition">subst</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> <span class="id" type="var">t1</span>) (<a class="idref" href="Records.html#subst"><span class="id" type="definition">subst</span></a> <span class="id" type="var">x</span> <span class="id" type="var">s</span> <span class="id" type="var">tr1</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab592"></a><h3 class="section">Reduction</h3>

<div class="paragraph"> </div>

 Next we define the values of our language.  A record is a value if
    all of its fields are. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="STLCExtendedRecords.value"><span class="id" type="inductive">value</span></a> : <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" type="inductive">tm</span></a> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.v_abs"><span class="id" type="constructor">v_abs</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">x</span> <span class="id" type="var">T11</span> <span class="id" type="var">t12</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#value"><span class="id" type="inductive">value</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_abs"><span class="id" type="constructor">tm_abs</span></a> <span class="id" type="var">x</span> <span class="id" type="var">T11</span> <span class="id" type="var">t12</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.v_rnil"><span class="id" type="constructor">v_rnil</span></a> : <a class="idref" href="Records.html#value"><span class="id" type="inductive">value</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.tm_rnil"><span class="id" type="constructor">tm_rnil</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.v_rcons"><span class="id" type="constructor">v_rcons</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">i</span> <span class="id" type="var">v1</span> <span class="id" type="var">vr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#value"><span class="id" type="inductive">value</span></a> <span class="id" type="var">v1</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#value"><span class="id" type="inductive">value</span></a> <span class="id" type="var">vr</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#value"><span class="id" type="inductive">value</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">v1</span> <span class="id" type="var">vr</span>).<br/>

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="var">Constructors</span> <span class="id" type="var">value</span>.<br/>

<br/>
</div>

<div class="doc">
Utility functions for extracting one field from record type or
    term: 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="STLCExtendedRecords.ty_lookup"><span class="id" type="definition">ty_lookup</span></a> (<span class="id" type="var">i</span>:<a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a>) (<span class="id" type="var">Tr</span>:<a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" type="inductive">ty</span></a>) : <span class="id" type="inductive">option</span> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" type="inductive">ty</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">Tr</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.ty_rcons"><span class="id" type="constructor">ty_rcons</span></a> <span class="id" type="var">i'</span> <span class="id" type="var">T</span> <span class="id" type="var">Tr'</span> =&gt; <span class="id" type="keyword">if</span> <a class="idref" href="SfLib.html#beq_id"><span class="id" type="definition">beq_id</span></a> <span class="id" type="var">i</span> <span class="id" type="var">i'</span> <span class="id" type="keyword">then</span> <span class="id" type="constructor">Some</span> <span class="id" type="var">T</span> <span class="id" type="keyword">else</span> <a class="idref" href="Records.html#ty_lookup"><span class="id" type="definition">ty_lookup</span></a> <span class="id" type="var">i</span> <span class="id" type="var">Tr'</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="constructor">None</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <a name="STLCExtendedRecords.tm_lookup"><span class="id" type="definition">tm_lookup</span></a> (<span class="id" type="var">i</span>:<a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a>) (<span class="id" type="var">tr</span>:<a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" type="inductive">tm</span></a>) : <span class="id" type="inductive">option</span> <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" type="inductive">tm</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">tr</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i'</span> <span class="id" type="var">t</span> <span class="id" type="var">tr'</span> =&gt; <span class="id" type="keyword">if</span> <a class="idref" href="SfLib.html#beq_id"><span class="id" type="definition">beq_id</span></a> <span class="id" type="var">i</span> <span class="id" type="var">i'</span> <span class="id" type="keyword">then</span> <span class="id" type="constructor">Some</span> <span class="id" type="var">t</span> <span class="id" type="keyword">else</span> <a class="idref" href="Records.html#tm_lookup"><span class="id" type="definition">tm_lookup</span></a> <span class="id" type="var">i</span> <span class="id" type="var">tr'</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="constructor">None</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" type="var">step</span></span> function uses the term-level lookup function (for the
    projection rule), while the type-level lookup is needed for
    <span class="inlinecode"><span class="id" type="var">has_type</span></span>. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Reserved Notation</span> "t1 '<span style="font-family: arial;">&rArr;</span>' t2" (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <a name="STLCExtendedRecords.step"><span class="id" type="inductive">step</span></a> : <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" type="inductive">tm</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" type="inductive">tm</span></a> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_AppAbs"><span class="id" type="constructor">ST_AppAbs</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">x</span> <span class="id" type="var">T11</span> <span class="id" type="var">t12</span> <span class="id" type="var">v2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.value"><span class="id" type="inductive">value</span></a> <span class="id" type="var">v2</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_abs"><span class="id" type="constructor">tm_abs</span></a> <span class="id" type="var">x</span> <span class="id" type="var">T11</span> <span class="id" type="var">t12</span>) <span class="id" type="var">v2</span>) <span style="font-family: arial;">&rArr;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.subst"><span class="id" type="definition">subst</span></a> <span class="id" type="var">x</span> <span class="id" type="var">v2</span> <span class="id" type="var">t12</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_App1"><span class="id" type="constructor">ST_App1</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1'</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t1</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t1'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span style="font-family: arial;">&rArr;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> <span class="id" type="var">t1'</span> <span class="id" type="var">t2</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_App2"><span class="id" type="constructor">ST_App2</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">v1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.value"><span class="id" type="inductive">value</span></a> <span class="id" type="var">v1</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t2</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t2'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> <span class="id" type="var">v1</span> <span class="id" type="var">t2</span>) <span style="font-family: arial;">&rArr;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> <span class="id" type="var">v1</span> <span class="id" type="var">t2'</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_Proj1"><span class="id" type="constructor">ST_Proj1</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1'</span> <span class="id" type="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t1</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t1'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_proj"><span class="id" type="constructor">tm_proj</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">i</span>) <span style="font-family: arial;">&rArr;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_proj"><span class="id" type="constructor">tm_proj</span></a> <span class="id" type="var">t1'</span> <span class="id" type="var">i</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_ProjRcd"><span class="id" type="constructor">ST_ProjRcd</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">tr</span> <span class="id" type="var">i</span> <span class="id" type="var">vi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.value"><span class="id" type="inductive">value</span></a> <span class="id" type="var">tr</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.tm_lookup"><span class="id" type="definition">tm_lookup</span></a> <span class="id" type="var">i</span> <span class="id" type="var">tr</span> = <span class="id" type="constructor">Some</span> <span class="id" type="var">vi</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_proj"><span class="id" type="constructor">tm_proj</span></a> <span class="id" type="var">tr</span> <span class="id" type="var">i</span>) <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">vi</span><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_Rcd_Head"><span class="id" type="constructor">ST_Rcd_Head</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">i</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1'</span> <span class="id" type="var">tr2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t1</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t1'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">t1</span> <span class="id" type="var">tr2</span>) <span style="font-family: arial;">&rArr;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">t1'</span> <span class="id" type="var">tr2</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_Rcd_Tail"><span class="id" type="constructor">ST_Rcd_Tail</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">i</span> <span class="id" type="var">v1</span> <span class="id" type="var">tr2</span> <span class="id" type="var">tr2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.value"><span class="id" type="inductive">value</span></a> <span class="id" type="var">v1</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tr2</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">tr2'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">v1</span> <span class="id" type="var">tr2</span>) <span style="font-family: arial;">&rArr;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">v1</span> <span class="id" type="var">tr2'</span>)<br/>
<br/>
<span class="id" type="keyword">where</span> "t1 '<span style="font-family: arial;">&rArr;</span>' t2" := (<a class="idref" href="Records.html#step"><span class="id" type="inductive">step</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "step_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_AppAbs" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_App1" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_App2"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_Proj1" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_ProjRcd"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_Rcd_Head" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_Rcd_Tail" ].<br/>

<br/>
<span class="id" type="keyword">Notation</span> <a name="STLCExtendedRecords.stepmany"><span class="id" type="abbreviation">stepmany</span></a> := (<a class="idref" href="SfLib.html#refl_step_closure"><span class="id" type="inductive">refl_step_closure</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.step"><span class="id" type="inductive">step</span></a>).<br/>
<span class="id" type="keyword">Notation</span> "t1 '<span style="font-family: arial;">&rArr;*</span>' t2" := (<a class="idref" href="Records.html#STLCExtendedRecords.stepmany"><span class="id" type="abbreviation">stepmany</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="var">Constructors</span> <span class="id" type="var">step</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab593"></a><h3 class="section">Typing</h3>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Definition</span> <a name="STLCExtendedRecords.context"><span class="id" type="definition">context</span></a> := <a class="idref" href="SfLib.html#partial_map"><span class="id" type="definition">partial_map</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" type="inductive">ty</span></a>.<br/>

<br/>
</div>

<div class="doc">
Next we define the typing rules.  These are nearly direct
    transcriptions of the inference rules shown above.  The only major
    difference is the use of <span class="inlinecode"><span class="id" type="var">well_formed_ty</span></span>.  In the informal
    presentation we used a grammar that only allowed well formed
    record types, so we didn't have to add a separate check.

<div class="paragraph"> </div>

    We'd like to set things up so that that whenever <span class="inlinecode"><span class="id" type="var">has_type</span></span> <span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span>
    <span class="inlinecode"><span class="id" type="var">T</span></span> holds, we also have <span class="inlinecode"><span class="id" type="var">well_formed_ty</span></span> <span class="inlinecode"><span class="id" type="var">T</span></span>.  That is, <span class="inlinecode"><span class="id" type="var">has_type</span></span>
    never assigns ill-formed types to terms.  In fact, we prove this
    theorem below.

<div class="paragraph"> </div>

    However, we don't want to clutter the definition of <span class="inlinecode"><span class="id" type="var">has_type</span></span>
    with unnecessary uses of <span class="inlinecode"><span class="id" type="var">well_formed_ty</span></span>.  Instead, we place
    <span class="inlinecode"><span class="id" type="var">well_formed_ty</span></span> checks only where needed - where an inductive
    call to <span class="inlinecode"><span class="id" type="var">has_type</span></span> won't already be checking the well-formedness
    of a type.

<div class="paragraph"> </div>

    For example, we check <span class="inlinecode"><span class="id" type="var">well_formed_ty</span></span> <span class="inlinecode"><span class="id" type="var">T</span></span> in the <span class="inlinecode"><span class="id" type="var">T_Var</span></span> case,
    because there is no inductive <span class="inlinecode"><span class="id" type="var">has_type</span></span> call that would 
    enforce this.  Similarly, in the <span class="inlinecode"><span class="id" type="var">T_Abs</span></span> case, we require a
    proof of <span class="inlinecode"><span class="id" type="var">well_formed_ty</span></span> <span class="inlinecode"><span class="id" type="var">T11</span></span> because the inductive call to
    <span class="inlinecode"><span class="id" type="var">has_type</span></span> only guarantees that <span class="inlinecode"><span class="id" type="var">T12</span></span> is well-formed.

<div class="paragraph"> </div>

    In the rules you must write, the only necessary <span class="inlinecode"><span class="id" type="var">well_formed_ty</span></span>
    check comes in the <span class="inlinecode"><span class="id" type="var">tm_nil</span></span> case.  
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> : <a class="idref" href="Records.html#STLCExtendedRecords.context"><span class="id" type="definition">context</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" type="inductive">tm</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" type="inductive">ty</span></a> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.T_Var"><span class="id" type="constructor">T_Var</span></a> : <span style="font-family: arial;">&forall;</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">x</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">x</span> = <span class="id" type="constructor">Some</span> <span class="id" type="var">T</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> <span class="id" type="var">T</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_var"><span class="id" type="constructor">tm_var</span></a> <span class="id" type="var">x</span>) <span class="id" type="var">T</span><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.T_Abs"><span class="id" type="constructor">T_Abs</span></a> : <span style="font-family: arial;">&forall;</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">x</span> <span class="id" type="var">T11</span> <span class="id" type="var">T12</span> <span class="id" type="var">t12</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> <span class="id" type="var">T11</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#has_type"><span class="id" type="inductive">has_type</span></a> (<a class="idref" href="SfLib.html#extend"><span class="id" type="definition">extend</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">x</span> <span class="id" type="var">T11</span>) <span class="id" type="var">t12</span> <span class="id" type="var">T12</span> <span style="font-family: arial;">&rarr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_abs"><span class="id" type="constructor">tm_abs</span></a> <span class="id" type="var">x</span> <span class="id" type="var">T11</span> <span class="id" type="var">t12</span>) (<a class="idref" href="Records.html#STLCExtendedRecords.ty_arrow"><span class="id" type="constructor">ty_arrow</span></a> <span class="id" type="var">T11</span> <span class="id" type="var">T12</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.T_App"><span class="id" type="constructor">T_App</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">t1</span> (<a class="idref" href="Records.html#STLCExtendedRecords.ty_arrow"><span class="id" type="constructor">ty_arrow</span></a> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span>) <span style="font-family: arial;">&rarr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">t2</span> <span class="id" type="var">T1</span> <span style="font-family: arial;">&rarr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="var">T2</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;records:&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.T_Proj"><span class="id" type="constructor">T_Proj</span></a> : <span style="font-family: arial;">&forall;</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">i</span> <span class="id" type="var">t</span> <span class="id" type="var">Ti</span> <span class="id" type="var">Tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">t</span> <span class="id" type="var">Tr</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.ty_lookup"><span class="id" type="definition">ty_lookup</span></a> <span class="id" type="var">i</span> <span class="id" type="var">Tr</span> = <span class="id" type="constructor">Some</span> <span class="id" type="var">Ti</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_proj"><span class="id" type="constructor">tm_proj</span></a> <span class="id" type="var">t</span> <span class="id" type="var">i</span>) <span class="id" type="var">Ti</span><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.T_RNil"><span class="id" type="constructor">T_RNil</span></a> : <span style="font-family: arial;">&forall;</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <a class="idref" href="Records.html#STLCExtendedRecords.tm_rnil"><span class="id" type="constructor">tm_rnil</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.ty_rnil"><span class="id" type="constructor">ty_rnil</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.T_RCons"><span class="id" type="constructor">T_RCons</span></a> : <span style="font-family: arial;">&forall;</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">i</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span> <span class="id" type="var">tr</span> <span class="id" type="var">Tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">tr</span> <span class="id" type="var">Tr</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.record_ty"><span class="id" type="inductive">record_ty</span></a> <span class="id" type="var">Tr</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.record_tm"><span class="id" type="inductive">record_tm</span></a> <span class="id" type="var">tr</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">t</span> <span class="id" type="var">tr</span>) (<a class="idref" href="Records.html#STLCExtendedRecords.ty_rcons"><span class="id" type="constructor">ty_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">T</span> <span class="id" type="var">Tr</span>).<br/>

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="var">Constructors</span> <span class="id" type="var">has_type</span>.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "has_type_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_Var" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_Abs" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_App"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_Proj" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_RNil" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "T_RCons" ].<br/>

<br/>
</div>

<div class="doc">
<a name="lab594"></a><h2 class="section">Examples</h2>

<div class="paragraph"> </div>

<a name="lab595"></a><h4 class="section">Exercise: 2 stars (examples)</h4>
 Finish the proofs. 
<div class="paragraph"> </div>

 Feel free to use Coq's automation features in this proof.
    However, if you are not confident about how the type system works,
    you may want to carry out the proof first using the basic
    features (<span class="inlinecode"><span class="id" type="tactic">apply</span></span> instead of <span class="inlinecode"><span class="id" type="tactic">eapply</span></span>, in particular) and then
    perhaps compress it using automation. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Lemma</span> <a name="STLCExtendedRecords.typing_example_2"><span class="id" type="lemma">typing_example_2</span></a> : <br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> <a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_abs"><span class="id" type="constructor">tm_abs</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.ty_rcons"><span class="id" type="constructor">ty_rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i1"><span class="id" type="abbreviation">i1</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.ty_arrow"><span class="id" type="constructor">ty_arrow</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" type="abbreviation">A</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" type="abbreviation">A</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.ty_rcons"><span class="id" type="constructor">ty_rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i2"><span class="id" type="abbreviation">i2</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.ty_arrow"><span class="id" type="constructor">ty_arrow</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" type="abbreviation">B</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" type="abbreviation">B</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.ty_rnil"><span class="id" type="constructor">ty_rnil</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_proj"><span class="id" type="constructor">tm_proj</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_var"><span class="id" type="constructor">tm_var</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a>) <a class="idref" href="Records.html#STLCExtendedRecords.i2"><span class="id" type="abbreviation">i2</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i1"><span class="id" type="abbreviation">i1</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_abs"><span class="id" type="constructor">tm_abs</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" type="abbreviation">A</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_var"><span class="id" type="constructor">tm_var</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i2"><span class="id" type="abbreviation">i2</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_abs"><span class="id" type="constructor">tm_abs</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" type="abbreviation">B</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_var"><span class="id" type="constructor">tm_var</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.tm_rnil"><span class="id" type="constructor">tm_rnil</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.ty_arrow"><span class="id" type="constructor">ty_arrow</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" type="abbreviation">B</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" type="abbreviation">B</span></a>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>

<br/>
</div>

<div class="doc">
Before starting to prove this fact (or the one above!), make sure
    you understand what it is saying. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Example</span> <a name="STLCExtendedRecords.typing_nonexample"><span class="id" type="definition">typing_nonexample</span></a> : <br/>
&nbsp;&nbsp;~ <span style="font-family: arial;">&exist;</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> (<a class="idref" href="SfLib.html#extend"><span class="id" type="definition">extend</span></a> <a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.ty_rcons"><span class="id" type="constructor">ty_rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i2"><span class="id" type="abbreviation">i2</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.ty_arrow"><span class="id" type="constructor">ty_arrow</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" type="abbreviation">A</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" type="abbreviation">A</span></a>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.ty_rnil"><span class="id" type="constructor">ty_rnil</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i1"><span class="id" type="abbreviation">i1</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_abs"><span class="id" type="constructor">tm_abs</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" type="abbreviation">B</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_var"><span class="id" type="constructor">tm_var</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a>)) (<a class="idref" href="Records.html#STLCExtendedRecords.tm_var"><span class="id" type="constructor">tm_var</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">T</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>

<br/>
<span class="id" type="keyword">Example</span> <a name="STLCExtendedRecords.typing_nonexample_2"><span class="id" type="definition">typing_nonexample_2</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">y</span>,<br/>
&nbsp;&nbsp;~ <span style="font-family: arial;">&exist;</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> (<a class="idref" href="SfLib.html#extend"><span class="id" type="definition">extend</span></a> <a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <span class="id" type="var">y</span> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" type="abbreviation">A</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_abs"><span class="id" type="constructor">tm_abs</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.ty_rcons"><span class="id" type="constructor">ty_rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i1"><span class="id" type="abbreviation">i1</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" type="abbreviation">A</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.ty_rnil"><span class="id" type="constructor">ty_rnil</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_proj"><span class="id" type="constructor">tm_proj</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_var"><span class="id" type="constructor">tm_var</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" type="abbreviation">a</span></a>) <a class="idref" href="Records.html#STLCExtendedRecords.i1"><span class="id" type="abbreviation">i1</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i1"><span class="id" type="abbreviation">i1</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_var"><span class="id" type="constructor">tm_var</span></a> <span class="id" type="var">y</span>) (<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i2"><span class="id" type="abbreviation">i2</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_var"><span class="id" type="constructor">tm_var</span></a> <span class="id" type="var">y</span>) <a class="idref" href="Records.html#STLCExtendedRecords.tm_rnil"><span class="id" type="constructor">tm_rnil</span></a>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">T</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab596"></a><h2 class="section">Properties of Typing</h2>

<div class="paragraph"> </div>

 The proofs of progress and preservation for this system are
    essentially the same as for the pure simply typed lambda-calculus,
    but we need to add some technical lemmas involving records. 
<div class="paragraph"> </div>

<a name="lab597"></a><h3 class="section">Well-Formedness</h3>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Lemma</span> <a name="STLCExtendedRecords.wf_rcd_lookup"><span class="id" type="lemma">wf_rcd_lookup</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">i</span> <span class="id" type="var">T</span> <span class="id" type="var">Ti</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> <span class="id" type="var">T</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.ty_lookup"><span class="id" type="definition">ty_lookup</span></a> <span class="id" type="var">i</span> <span class="id" type="var">T</span> = <span class="id" type="constructor">Some</span> <span class="id" type="var">Ti</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> <span class="id" type="var">Ti</span>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">i</span> <span class="id" type="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">ty_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">T</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">try</span> <span class="id" type="var">solve</span> <span class="id" type="tactic">by</span> <span class="id" type="tactic">inversion</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "ty_rcons".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">subst</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">ty_lookup</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">remember</span> (<a class="idref" href="SfLib.html#beq_id"><span class="id" type="definition">beq_id</span></a> <span class="id" type="var">i</span> <span class="id" type="var">i0</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">b</span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>. <span class="id" type="tactic">subst</span>... <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="STLCExtendedRecords.step_preserves_record_tm"><span class="id" type="lemma">step_preserves_record_tm</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">tr</span> <span class="id" type="var">tr'</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.record_tm"><span class="id" type="inductive">record_tm</span></a> <span class="id" type="var">tr</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span class="id" type="var">tr</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">tr'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.record_tm"><span class="id" type="inductive">record_tm</span></a> <span class="id" type="var">tr'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">tr</span> <span class="id" type="var">tr'</span> <span class="id" type="var">Hrt</span> <span class="id" type="var">Hstp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hrt</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Hstp</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="STLCExtendedRecords.has_type__wf"><span class="id" type="lemma">has_type__wf</span></a> : <span style="font-family: arial;">&forall;</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#STLCExtendedRecords.well_formed_ty"><span class="id" type="inductive">well_formed_ty</span></a> <span class="id" type="var">T</span>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span> <span class="id" type="var">Htyp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Htyp</span>) <span class="id" type="var">Case</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_App".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">IHHtyp1</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Proj".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <a class="idref" href="Records.html#STLCExtendedRecords.wf_rcd_lookup"><span class="id" type="lemma">wf_rcd_lookup</span></a>...<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab598"></a><h3 class="section">Field Lookup</h3>

<div class="paragraph"> </div>

 Lemma: If <span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">v</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T</span></span> and <span class="inlinecode"><span class="id" type="var">ty_lookup</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">T</span></span> returns <span class="inlinecode"><span class="id" type="var">Some</span></span> <span class="inlinecode"><span class="id" type="var">Ti</span></span>,
     then <span class="inlinecode"><span class="id" type="var">tm_lookup</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">v</span></span> returns <span class="inlinecode"><span class="id" type="var">Some</span></span> <span class="inlinecode"><span class="id" type="var">ti</span></span> for some term <span class="inlinecode"><span class="id" type="var">ti</span></span> such
     that <span class="inlinecode"><span class="id" type="var">has_type</span></span> <span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span class="id" type="var">ti</span></span> <span class="inlinecode"><span class="id" type="var">Ti</span></span>.

<div class="paragraph"> </div>

    Proof: By induction on the typing derivation <span class="inlinecode"><span class="id" type="var">Htyp</span></span>.  Since
      <span class="inlinecode"><span class="id" type="var">ty_lookup</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">T</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">Some</span></span> <span class="inlinecode"><span class="id" type="var">Ti</span></span>, <span class="inlinecode"><span class="id" type="var">T</span></span> must be a record type, this and
      the fact that <span class="inlinecode"><span class="id" type="var">v</span></span> is a value eliminate most cases by inspection,
      leaving only the <span class="inlinecode"><span class="id" type="var">T_RCons</span></span> case.

<div class="paragraph"> </div>

      If the last step in the typing derivation is by <span class="inlinecode"><span class="id" type="var">T_RCons</span></span>, then
      <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">tm_rcons</span></span> <span class="inlinecode"><span class="id" type="var">i0</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span class="id" type="var">tr</span></span> and <span class="inlinecode"><span class="id" type="var">T</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">ty_rcons</span></span> <span class="inlinecode"><span class="id" type="var">i0</span></span> <span class="inlinecode"><span class="id" type="var">T</span></span> <span class="inlinecode"><span class="id" type="var">Tr</span></span> for some <span class="inlinecode"><span class="id" type="var">i0</span></span>,
      <span class="inlinecode"><span class="id" type="var">t</span></span>, <span class="inlinecode"><span class="id" type="var">tr</span></span>, <span class="inlinecode"><span class="id" type="var">T</span></span> and <span class="inlinecode"><span class="id" type="var">Tr</span></span>.

<div class="paragraph"> </div>

      This leaves two possiblities to consider - either <span class="inlinecode"><span class="id" type="var">i0</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">i</span></span> or
      not.

<div class="paragraph"> </div>

<ul class="doclist">
<li> If <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">i0</span></span>, then since <span class="inlinecode"><span class="id" type="var">ty_lookup</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode">(<span class="id" type="var">ty_rcons</span></span> <span class="inlinecode"><span class="id" type="var">i0</span></span> <span class="inlinecode"><span class="id" type="var">T</span></span> <span class="inlinecode"><span class="id" type="var">Tr</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">Some</span></span>
        <span class="inlinecode"><span class="id" type="var">Ti</span></span> we have <span class="inlinecode"><span class="id" type="var">T</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">Ti</span></span>.  It follows that <span class="inlinecode"><span class="id" type="var">t</span></span> itself satisfies
        the theorem.

<div class="paragraph"> </div>


</li>
<li> On the other hand, suppose <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode">&lt;&gt;</span> <span class="inlinecode"><span class="id" type="var">i0</span></span>.  Then 

<div class="paragraph"> </div>

<div class="code code-tight">
<span class="id" type="var">ty_lookup</span>&nbsp;<span class="id" type="var">i</span>&nbsp;<span class="id" type="var">T</span>&nbsp;=&nbsp;<span class="id" type="var">ty_lookup</span>&nbsp;<span class="id" type="var">i</span>&nbsp;<span class="id" type="var">Tr</span>
<div class="paragraph"> </div>

</div>
        and 

<div class="paragraph"> </div>

<div class="code code-tight">
<span class="id" type="var">tm_lookup</span>&nbsp;<span class="id" type="var">i</span>&nbsp;<span class="id" type="var">t</span>&nbsp;=&nbsp;<span class="id" type="var">tm_lookup</span>&nbsp;<span class="id" type="var">i</span>&nbsp;<span class="id" type="var">tr</span>,
<div class="paragraph"> </div>

</div>
        so the result follows from the induction hypothesis. <font size=-2>&#9744;</font> 
</li>
</ul>

</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Lemma</span> <a name="STLCExtendedRecords.lookup_field_in_value"><span class="id" type="lemma">lookup_field_in_value</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">v</span> <span class="id" type="var">T</span> <span class="id" type="var">i</span> <span class="id" type="var">Ti</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.value"><span class="id" type="inductive">value</span></a> <span class="id" type="var">v</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> <a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <span class="id" type="var">v</span> <span class="id" type="var">T</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.ty_lookup"><span class="id" type="definition">ty_lookup</span></a> <span class="id" type="var">i</span> <span class="id" type="var">T</span> = <span class="id" type="constructor">Some</span> <span class="id" type="var">Ti</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span> <span class="id" type="var">ti</span>, <a class="idref" href="Records.html#STLCExtendedRecords.tm_lookup"><span class="id" type="definition">tm_lookup</span></a> <span class="id" type="var">i</span> <span class="id" type="var">v</span> = <span class="id" type="constructor">Some</span> <span class="id" type="var">ti</span> <span style="font-family: arial;">&and;</span> <a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> <a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <span class="id" type="var">ti</span> <span class="id" type="var">Ti</span>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">T</span> <span class="id" type="var">i</span> <span class="id" type="var">Ti</span> <span class="id" type="var">Hval</span> <span class="id" type="var">Htyp</span> <span class="id" type="var">Hget</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> (@<a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" type="inductive">ty</span></a>) <span class="id" type="keyword">as</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Htyp</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">try</span> <span class="id" type="var">solve</span> <span class="id" type="tactic">by</span> <span class="id" type="tactic">inversion</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_RCons".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hget</span>. <span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">destruct</span> (<a class="idref" href="SfLib.html#beq_id"><span class="id" type="definition">beq_id</span></a> <span class="id" type="var">i</span> <span class="id" type="var">i0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "i is first".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">Hget</span>. <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span> <span class="id" type="var">t</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "get tail".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHHtyp2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">vi</span> [<span class="id" type="var">Hgeti</span> <span class="id" type="var">Htypi</span>]]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hval</span>... <span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab599"></a><h3 class="section">Progress</h3>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Theorem</span> <a name="STLCExtendedRecords.progress"><span class="id" type="lemma">progress</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> <a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <span class="id" type="var">t</span> <span class="id" type="var">T</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.value"><span class="id" type="inductive">value</span></a> <span class="id" type="var">t</span> <span style="font-family: arial;">&or;</span> <span style="font-family: arial;">&exist;</span> <span class="id" type="var">t'</span>, <span class="id" type="var">t</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t'</span>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Theorem:&nbsp;Suppose&nbsp;empty&nbsp;|-&nbsp;t&nbsp;:&nbsp;T.&nbsp;&nbsp;Then&nbsp;either<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;t&nbsp;is&nbsp;a&nbsp;value,&nbsp;or<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;t&nbsp;==&gt;&nbsp;t'&nbsp;for&nbsp;some&nbsp;t'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Proof:&nbsp;By&nbsp;induction&nbsp;on&nbsp;the&nbsp;given&nbsp;typing&nbsp;derivation.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span> <span class="id" type="var">Ht</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> (@<a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" type="inductive">ty</span></a>) <span class="id" type="keyword">as</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">HeqGamma</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Ht</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">HeqGamma</span>; <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Var".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;final&nbsp;rule&nbsp;in&nbsp;the&nbsp;given&nbsp;typing&nbsp;derivation&nbsp;cannot&nbsp;be&nbsp;<span class="inlinecode"><span class="id" type="var">T_Var</span></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;since&nbsp;it&nbsp;can&nbsp;never&nbsp;be&nbsp;the&nbsp;case&nbsp;that&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T</span></span>&nbsp;(since&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context&nbsp;is&nbsp;empty).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Abs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;the&nbsp;<span class="inlinecode"><span class="id" type="var">T_Abs</span></span>&nbsp;rule&nbsp;was&nbsp;the&nbsp;last&nbsp;used,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">tm_abs</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">T11</span></span> <span class="inlinecode"><span class="id" type="var">t12</span></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;is&nbsp;a&nbsp;value.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">left</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_App".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;the&nbsp;last&nbsp;rule&nbsp;applied&nbsp;was&nbsp;T_App,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">t1</span></span> <span class="inlinecode"><span class="id" type="var">t2</span></span>,&nbsp;and&nbsp;we&nbsp;know&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;the&nbsp;form&nbsp;of&nbsp;the&nbsp;rule&nbsp;that<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">t1</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T1</span></span> <span class="inlinecode"><span style="font-family: arial;">&rarr;</span></span> <span class="inlinecode"><span class="id" type="var">T2</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">t2</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T1</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;By&nbsp;the&nbsp;induction&nbsp;hypothesis,&nbsp;each&nbsp;of&nbsp;t1&nbsp;and&nbsp;t2&nbsp;either&nbsp;is&nbsp;a&nbsp;value&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;can&nbsp;take&nbsp;a&nbsp;step.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHHt1</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "t1 is a value".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHHt2</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SSCase</span> "t2 is a value".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;both&nbsp;<span class="inlinecode"><span class="id" type="var">t1</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" type="var">t2</span></span>&nbsp;are&nbsp;values,&nbsp;then&nbsp;we&nbsp;know&nbsp;that&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">t1</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">tm_abs</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">T11</span></span> <span class="inlinecode"><span class="id" type="var">t12</span></span>,&nbsp;since&nbsp;abstractions&nbsp;are&nbsp;the&nbsp;only&nbsp;values<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;can&nbsp;have&nbsp;an&nbsp;arrow&nbsp;type.&nbsp;&nbsp;But&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode">(<span class="id" type="var">tm_abs</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">T11</span></span> <span class="inlinecode"><span class="id" type="var">t12</span>)</span> <span class="inlinecode"><span class="id" type="var">t2</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="tactic">subst</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">t2</span></span> <span class="inlinecode"><span class="id" type="var">t12</span></span>&nbsp;by&nbsp;<span class="inlinecode"><span class="id" type="var">ST_AppAbs</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">try</span> (<span class="id" type="var">solve</span> <span class="id" type="tactic">by</span> <span class="id" type="tactic">inversion</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.subst"><span class="id" type="definition">subst</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t2</span> <span class="id" type="var">t12</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SSCase</span> "t2 steps".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" type="var">t1</span></span>&nbsp;is&nbsp;a&nbsp;value&nbsp;and&nbsp;<span class="inlinecode"><span class="id" type="var">t2</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">t2'</span></span>,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" type="var">t1</span></span> <span class="inlinecode"><span class="id" type="var">t2</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">t1</span></span> <span class="inlinecode"><span class="id" type="var">t2'</span></span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;<span class="inlinecode"><span class="id" type="var">ST_App2</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">H0</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t2'</span> <span class="id" type="var">Hstp</span>]. <span style="font-family: arial;">&exist;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2'</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "t1 steps".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Finally,&nbsp;If&nbsp;<span class="inlinecode"><span class="id" type="var">t1</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">t1'</span></span>,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" type="var">t1</span></span> <span class="inlinecode"><span class="id" type="var">t2</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">t1'</span></span> <span class="inlinecode"><span class="id" type="var">t2</span></span>&nbsp;by&nbsp;<span class="inlinecode"><span class="id" type="var">ST_App1</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1'</span> <span class="id" type="var">Hstp</span>]. <span style="font-family: arial;">&exist;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> <span class="id" type="var">t1'</span> <span class="id" type="var">t2</span>)...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Proj".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;the&nbsp;last&nbsp;rule&nbsp;in&nbsp;the&nbsp;given&nbsp;derivation&nbsp;is&nbsp;<span class="inlinecode"><span class="id" type="var">T_Proj</span></span>,&nbsp;then&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">tm_proj</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span>&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">:</span> <span class="inlinecode">(<span class="id" type="var">ty_rcd</span></span> <span class="inlinecode"><span class="id" type="var">Tr</span>)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;By&nbsp;the&nbsp;IH,&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span>&nbsp;either&nbsp;is&nbsp;a&nbsp;value&nbsp;or&nbsp;takes&nbsp;a&nbsp;step.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">right</span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">IHHt</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "rcd is value".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span>&nbsp;is&nbsp;a&nbsp;value,&nbsp;then&nbsp;we&nbsp;may&nbsp;use&nbsp;lemma<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">lookup_field_in_value</span></span>&nbsp;to&nbsp;show&nbsp;<span class="inlinecode"><span class="id" type="var">tm_lookup</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">Some</span></span> <span class="inlinecode"><span class="id" type="var">ti</span></span>&nbsp;for<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;some&nbsp;<span class="inlinecode"><span class="id" type="var">ti</span></span>&nbsp;which&nbsp;gives&nbsp;us&nbsp;<span class="inlinecode"><span class="id" type="var">tm_proj</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">ti</span></span>&nbsp;by&nbsp;<span class="inlinecode"><span class="id" type="var">ST_ProjRcd</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="Records.html#STLCExtendedRecords.lookup_field_in_value"><span class="id" type="lemma">lookup_field_in_value</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H0</span> <span class="id" type="var">Ht</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ti</span> [<span class="id" type="var">Hlkup</span> <span class="id" type="var">_</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span> <span class="id" type="var">ti</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "rcd_steps".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;On&nbsp;the&nbsp;other&nbsp;hand,&nbsp;if&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">t'</span></span>,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" type="var">tm_proj</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">tm_proj</span></span> <span class="inlinecode"><span class="id" type="var">t'</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;<span class="inlinecode"><span class="id" type="var">ST_Proj1</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">H0</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">Hstp</span>]. <span style="font-family: arial;">&exist;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_proj"><span class="id" type="constructor">tm_proj</span></a> <span class="id" type="var">t'</span> <span class="id" type="var">i</span>)...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_RNil".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;the&nbsp;last&nbsp;rule&nbsp;in&nbsp;the&nbsp;given&nbsp;derivation&nbsp;is&nbsp;<span class="inlinecode"><span class="id" type="var">T_RNil</span></span>,&nbsp;then&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">tm_rnil</span></span>,&nbsp;which&nbsp;is&nbsp;a&nbsp;value.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">left</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_RCons".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;the&nbsp;last&nbsp;rule&nbsp;is&nbsp;<span class="inlinecode"><span class="id" type="var">T_RCons</span></span>,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">tm_rcons</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span class="id" type="var">tr</span></span>&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">tr</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">Tr</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;By&nbsp;the&nbsp;IH,&nbsp;each&nbsp;of&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" type="var">tr</span></span>&nbsp;either&nbsp;is&nbsp;a&nbsp;value&nbsp;or&nbsp;can&nbsp;take<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;step.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHHt1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "head is a value".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHHt2</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SSCase</span> "tail is a value".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" type="var">tr</span></span>&nbsp;are&nbsp;both&nbsp;values,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" type="var">tm_rcons</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span class="id" type="var">tr</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;value&nbsp;as&nbsp;well.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">left</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SSCase</span> "tail steps".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span>&nbsp;is&nbsp;a&nbsp;value&nbsp;and&nbsp;<span class="inlinecode"><span class="id" type="var">tr</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">tr'</span></span>,&nbsp;then&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">tm_rcons</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span class="id" type="var">tr</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">tm_rcons</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span class="id" type="var">tr'</span></span>&nbsp;by&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">ST_Rcd_Tail</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">right</span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">tr'</span> <span class="id" type="var">Hstp</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">t</span> <span class="id" type="var">tr'</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "head steps".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">t'</span></span>,&nbsp;then&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">tm_rcons</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span class="id" type="var">tr</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">tm_rcons</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">t'</span></span> <span class="inlinecode"><span class="id" type="var">tr</span></span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;<span class="inlinecode"><span class="id" type="var">ST_Rcd_Head</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">right</span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">Hstp</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">t'</span> <span class="id" type="var">tr</span>)... <span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab600"></a><h3 class="section">Context Invariance</h3>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="STLCExtendedRecords.appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> : <a class="idref" href="SfLib.html#id"><span class="id" type="inductive">id</span></a> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" type="inductive">tm</span></a> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_var"><span class="id" type="constructor">afi_var</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_var"><span class="id" type="constructor">tm_var</span></a> <span class="id" type="var">x</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_app1"><span class="id" type="constructor">afi_app1</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">x</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t1</span> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_app2"><span class="id" type="constructor">afi_app2</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">x</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t2</span> <span style="font-family: arial;">&rarr;</span> <a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_app"><span class="id" type="constructor">tm_app</span></a> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_abs"><span class="id" type="constructor">afi_abs</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">T11</span> <span class="id" type="var">t12</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">y</span> &lt;&gt; <span class="id" type="var">x</span>  <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t12</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_abs"><span class="id" type="constructor">tm_abs</span></a> <span class="id" type="var">y</span> <span class="id" type="var">T11</span> <span class="id" type="var">t12</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_proj"><span class="id" type="constructor">afi_proj</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_proj"><span class="id" type="constructor">tm_proj</span></a> <span class="id" type="var">t</span> <span class="id" type="var">i</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_rhead"><span class="id" type="constructor">afi_rhead</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">x</span> <span class="id" type="var">i</span> <span class="id" type="var">ti</span> <span class="id" type="var">tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> <span class="id" type="var">ti</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">ti</span> <span class="id" type="var">tr</span>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_rtail"><span class="id" type="constructor">afi_rtail</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">x</span> <span class="id" type="var">i</span> <span class="id" type="var">ti</span> <span class="id" type="var">tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> <span class="id" type="var">tr</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> (<a class="idref" href="Records.html#STLCExtendedRecords.tm_rcons"><span class="id" type="constructor">tm_rcons</span></a> <span class="id" type="var">i</span> <span class="id" type="var">ti</span> <span class="id" type="var">tr</span>).<br/>

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="var">Constructors</span> <span class="id" type="var">appears_free_in</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="STLCExtendedRecords.context_invariance"><span class="id" type="lemma">context_invariance</span></a> : <span style="font-family: arial;">&forall;</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">Gamma'</span> <span class="id" type="var">t</span> <span class="id" type="var">S</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">t</span> <span class="id" type="var">S</span>  <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span style="font-family: arial;">&forall;</span> <span class="id" type="var">x</span>, <a class="idref" href="Records.html#STLCExtendedRecords.appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span style="font-family: arial;">&rarr;</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">x</span> = <span class="id" type="var">Gamma'</span> <span class="id" type="var">x</span>)  <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> <span class="id" type="var">Gamma'</span> <span class="id" type="var">t</span> <span class="id" type="var">S</span>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">Gamma'</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">H</span>) <span class="id" type="var">Case</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Gamma'</span> <span class="id" type="var">Heqv</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Var".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_Var"><span class="id" type="constructor">T_Var</span></a>... <span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&larr;</span> <span class="id" type="var">Heqv</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Abs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_Abs"><span class="id" type="constructor">T_Abs</span></a>... <span class="id" type="tactic">apply</span> <span class="id" type="var">IHhas_type</span>. <span class="id" type="tactic">intros</span> <span class="id" type="var">y</span> <span class="id" type="var">Hafi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">extend</span>. <span class="id" type="var">remember</span> (<a class="idref" href="SfLib.html#beq_id"><span class="id" type="definition">beq_id</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">e</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_App".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_App"><span class="id" type="constructor">T_App</span></a> <span class="id" type="keyword">with</span> <span class="id" type="var">T1</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_RCons".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_RCons"><span class="id" type="constructor">T_RCons</span></a>... <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="STLCExtendedRecords.free_in_context"><span class="id" type="lemma">free_in_context</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span>,<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.appears_free_in"><span class="id" type="inductive">appears_free_in</span></a> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span> <span class="id" type="var">T'</span>, <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">x</span> = <span class="id" type="constructor">Some</span> <span class="id" type="var">T'</span>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">T</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">Hafi</span> <span class="id" type="var">Htyp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Htyp</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Hafi</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Abs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHHtyp</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">T'</span> <span class="id" type="var">Hctx</span>]... <span style="font-family: arial;">&exist;</span> <span class="id" type="var">T'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">extend</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hctx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="SfLib.html#not_eq_beq_id_false"><span class="id" type="lemma">not_eq_beq_id_false</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">H3</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hctx</span>...<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab601"></a><h3 class="section">Preservation</h3>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Lemma</span> <a name="STLCExtendedRecords.substitution_preserves_typing"><span class="id" type="lemma">substitution_preserves_typing</span></a> : <span style="font-family: arial;">&forall;</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">x</span> <span class="id" type="var">U</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span> <span class="id" type="var">S</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> (<a class="idref" href="SfLib.html#extend"><span class="id" type="definition">extend</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">x</span> <span class="id" type="var">U</span>) <span class="id" type="var">t</span> <span class="id" type="var">S</span>  <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> <a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <span class="id" type="var">v</span> <span class="id" type="var">U</span>   <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> <span style="font-family: serif; font-size:85%;">&Gamma;</span> (<a class="idref" href="Records.html#STLCExtendedRecords.subst"><span class="id" type="definition">subst</span></a> <span class="id" type="var">x</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>) <span class="id" type="var">S</span>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Theorem:&nbsp;If&nbsp;Gamma,x:U&nbsp;|-&nbsp;t&nbsp;:&nbsp;S&nbsp;and&nbsp;empty&nbsp;|-&nbsp;v&nbsp;:&nbsp;U,&nbsp;then&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gamma&nbsp;|-&nbsp;(subst&nbsp;x&nbsp;v&nbsp;t)&nbsp;S.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">x</span> <span class="id" type="var">U</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span> <span class="id" type="var">S</span> <span class="id" type="var">Htypt</span> <span class="id" type="var">Htypv</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span>. <span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">S</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Proof:&nbsp;By&nbsp;induction&nbsp;on&nbsp;the&nbsp;term&nbsp;t.&nbsp;&nbsp;Most&nbsp;cases&nbsp;follow&nbsp;directly<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;the&nbsp;IH,&nbsp;with&nbsp;the&nbsp;exception&nbsp;of&nbsp;tm_var,&nbsp;tm_abs,&nbsp;tm_rcons.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;former&nbsp;aren't&nbsp;automatic&nbsp;because&nbsp;we&nbsp;must&nbsp;reason&nbsp;about&nbsp;how&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;variables&nbsp;interact.&nbsp;In&nbsp;the&nbsp;case&nbsp;of&nbsp;tm_rcons,&nbsp;we&nbsp;must&nbsp;do&nbsp;a&nbsp;little<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extra&nbsp;work&nbsp;to&nbsp;show&nbsp;that&nbsp;substituting&nbsp;into&nbsp;a&nbsp;term&nbsp;doesn't&nbsp;change<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whether&nbsp;it&nbsp;is&nbsp;a&nbsp;record&nbsp;term.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" type="var">tm_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">t</span>) <span class="id" type="var">Case</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">S</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span> <span class="id" type="var">Htypt</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Htypt</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "tm_var".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">rename</span> <span class="id" type="var">i</span> <span class="id" type="var">into</span> <span class="id" type="var">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;t&nbsp;=&nbsp;y,&nbsp;we&nbsp;know&nbsp;that<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">v</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">U</span></span>&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span>,<span class="id" type="var">x</span>:<span class="id" type="var">U</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">y</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">S</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and,&nbsp;by&nbsp;inversion,&nbsp;<span class="inlinecode"><span class="id" type="var">extend</span></span> <span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">U</span></span> <span class="inlinecode"><span class="id" type="var">y</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">Some</span></span> <span class="inlinecode"><span class="id" type="var">S</span></span>.&nbsp;&nbsp;We&nbsp;want&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;show&nbsp;that&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="tactic">subst</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">v</span></span> <span class="inlinecode"><span class="id" type="var">y</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">S</span></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:&nbsp;either&nbsp;<span class="inlinecode"><span class="id" type="var">x</span>=<span class="id" type="var">y</span></span>&nbsp;or&nbsp;<span class="inlinecode"><span class="id" type="var">x</span>&lt;&gt;<span class="id" type="var">y</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">remember</span> (<a class="idref" href="SfLib.html#beq_id"><span class="id" type="definition">beq_id</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">e</span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "x=y".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">y</span></span>,&nbsp;then&nbsp;we&nbsp;know&nbsp;that&nbsp;<span class="inlinecode"><span class="id" type="var">U</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">S</span></span>,&nbsp;and&nbsp;that&nbsp;<span class="inlinecode"><span class="id" type="tactic">subst</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">v</span></span> <span class="inlinecode"><span class="id" type="var">y</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">v</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;So&nbsp;what&nbsp;we&nbsp;really&nbsp;must&nbsp;show&nbsp;is&nbsp;that&nbsp;if&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">v</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">U</span></span>&nbsp;then<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">v</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">U</span></span>.&nbsp;&nbsp;We&nbsp;have&nbsp;already&nbsp;proven&nbsp;a&nbsp;more&nbsp;general&nbsp;version<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;this&nbsp;theorem,&nbsp;called&nbsp;context&nbsp;invariance.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="SfLib.html#beq_id_eq"><span class="id" type="lemma">beq_id_eq</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">Heqe</span>. <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">extend</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>. <span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&larr;</span> <a class="idref" href="SfLib.html#beq_id_refl"><span class="id" type="lemma">beq_id_refl</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">subst</span>. <span class="id" type="tactic">clear</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <a class="idref" href="Records.html#STLCExtendedRecords.context_invariance"><span class="id" type="lemma">context_invariance</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">Hcontra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="Records.html#STLCExtendedRecords.free_in_context"><span class="id" type="lemma">free_in_context</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">S</span> <a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <span class="id" type="var">Hcontra</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">T'</span> <span class="id" type="var">HT'</span>]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">HT'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "x&lt;&gt;y".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode">&lt;&gt;</span> <span class="inlinecode"><span class="id" type="var">y</span></span>,&nbsp;then&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span></span> <span class="inlinecode"><span class="id" type="var">y</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">Some</span></span> <span class="inlinecode"><span class="id" type="var">S</span></span>&nbsp;and&nbsp;the&nbsp;substitution&nbsp;has&nbsp;no<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;effect.&nbsp;&nbsp;We&nbsp;can&nbsp;show&nbsp;that&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">y</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">S</span></span>&nbsp;by&nbsp;<span class="inlinecode"><span class="id" type="var">T_Var</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_Var"><span class="id" type="constructor">T_Var</span></a>... <span class="id" type="tactic">unfold</span> <span class="id" type="var">extend</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>. <span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&larr;</span> <span class="id" type="var">Heqe</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "tm_abs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rename</span> <span class="id" type="var">i</span> <span class="id" type="var">into</span> <span class="id" type="var">y</span>. <span class="id" type="tactic">rename</span> <span class="id" type="var">t</span> <span class="id" type="var">into</span> <span class="id" type="var">T11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">tm_abs</span></span> <span class="inlinecode"><span class="id" type="var">y</span></span> <span class="inlinecode"><span class="id" type="var">T11</span></span> <span class="inlinecode"><span class="id" type="var">t0</span></span>,&nbsp;then&nbsp;we&nbsp;know&nbsp;that<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span>,<span class="id" type="var">x</span>:<span class="id" type="var">U</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">tm_abs</span></span> <span class="inlinecode"><span class="id" type="var">y</span></span> <span class="inlinecode"><span class="id" type="var">T11</span></span> <span class="inlinecode"><span class="id" type="var">t0</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T11</span><span style="font-family: arial;">&rarr;</span><span class="id" type="var">T12</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span>,<span class="id" type="var">x</span>:<span class="id" type="var">U</span>,<span class="id" type="var">y</span>:<span class="id" type="var">T11</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">t0</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T12</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">v</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">U</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As&nbsp;our&nbsp;IH,&nbsp;we&nbsp;know&nbsp;that&nbsp;forall&nbsp;S&nbsp;Gamma,&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span>,<span class="id" type="var">x</span>:<span class="id" type="var">U</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">t0</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">S</span></span> <span class="inlinecode"><span style="font-family: arial;">&rarr;</span></span> <span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="tactic">subst</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">v</span></span> <span class="inlinecode"><span class="id" type="var">t0</span></span> <span class="inlinecode"><span class="id" type="var">S</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;can&nbsp;calculate&nbsp;that&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst&nbsp;x&nbsp;v&nbsp;t&nbsp;=&nbsp;tm_abs&nbsp;y&nbsp;T11&nbsp;(if&nbsp;beq_id&nbsp;x&nbsp;y<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;t0&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;subst&nbsp;x&nbsp;v&nbsp;t0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;And&nbsp;we&nbsp;must&nbsp;show&nbsp;that&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="tactic">subst</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">v</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T11</span><span style="font-family: arial;">&rarr;</span><span class="id" type="var">T12</span></span>.&nbsp;&nbsp;We&nbsp;know<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;will&nbsp;do&nbsp;so&nbsp;using&nbsp;<span class="inlinecode"><span class="id" type="var">T_Abs</span></span>,&nbsp;so&nbsp;it&nbsp;remains&nbsp;to&nbsp;be&nbsp;shown&nbsp;that:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span>,<span class="id" type="var">y</span>:<span class="id" type="var">T11</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="keyword">if</span></span> <span class="inlinecode"><span class="id" type="var">beq_id</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">y</span></span> <span class="inlinecode"><span class="id" type="keyword">then</span></span> <span class="inlinecode"><span class="id" type="var">t0</span></span> <span class="inlinecode"><span class="id" type="keyword">else</span></span> <span class="inlinecode"><span class="id" type="tactic">subst</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">v</span></span> <span class="inlinecode"><span class="id" type="var">t0</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T12</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;consider&nbsp;two&nbsp;cases:&nbsp;<span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">y</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode">&lt;&gt;</span> <span class="inlinecode"><span class="id" type="var">y</span></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_Abs"><span class="id" type="constructor">T_Abs</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">remember</span> (<a class="idref" href="SfLib.html#beq_id"><span class="id" type="definition">beq_id</span></a> <span class="id" type="var">x</span> <span class="id" type="var">y</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">e</span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "x=y".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">y</span></span>,&nbsp;then&nbsp;the&nbsp;substitution&nbsp;has&nbsp;no&nbsp;effect.&nbsp;&nbsp;Context<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invariance&nbsp;shows&nbsp;that&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span>,<span class="id" type="var">y</span>:<span class="id" type="var">U</span>,<span class="id" type="var">y</span>:<span class="id" type="var">T11</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span>,<span class="id" type="var">y</span>:<span class="id" type="var">T11</span></span>&nbsp;are<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equivalent.&nbsp;&nbsp;Since&nbsp;the&nbsp;former&nbsp;context&nbsp;shows&nbsp;that&nbsp;<span class="inlinecode"><span class="id" type="var">t0</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T12</span></span>,&nbsp;so<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;does&nbsp;the&nbsp;latter.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <a class="idref" href="Records.html#STLCExtendedRecords.context_invariance"><span class="id" type="lemma">context_invariance</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="SfLib.html#beq_id_eq"><span class="id" type="lemma">beq_id_eq</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">Heqe</span>. <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">Hafi</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">extend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="SfLib.html#beq_id"><span class="id" type="definition">beq_id</span></a> <span class="id" type="var">y</span> <span class="id" type="var">x</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "x&lt;&gt;y".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;<span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode">&lt;&gt;</span> <span class="inlinecode"><span class="id" type="var">y</span></span>,&nbsp;then&nbsp;the&nbsp;IH&nbsp;and&nbsp;context&nbsp;invariance&nbsp;allow&nbsp;us&nbsp;to&nbsp;show&nbsp;that<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span>,<span class="id" type="var">x</span>:<span class="id" type="var">U</span>,<span class="id" type="var">y</span>:<span class="id" type="var">T11</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">t0</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T12</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span>,<span class="id" type="var">y</span>:<span class="id" type="var">T11</span>,<span class="id" type="var">x</span>:<span class="id" type="var">U</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">t0</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T12</span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span style="font-family: serif; font-size:85%;">&Gamma;</span>,<span class="id" type="var">y</span>:<span class="id" type="var">T11</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="tactic">subst</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">v</span></span> <span class="inlinecode"><span class="id" type="var">t0</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T12</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHt</span>. <span class="id" type="tactic">eapply</span> <a class="idref" href="Records.html#STLCExtendedRecords.context_invariance"><span class="id" type="lemma">context_invariance</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">z</span> <span class="id" type="var">Hafi</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">extend</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">remember</span> (<a class="idref" href="SfLib.html#beq_id"><span class="id" type="definition">beq_id</span></a> <span class="id" type="var">y</span> <span class="id" type="var">z</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">e0</span>. <span class="id" type="tactic">destruct</span> <span class="id" type="var">e0</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="SfLib.html#beq_id_eq"><span class="id" type="lemma">beq_id_eq</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">Heqe0</span>. <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&larr;</span> <span class="id" type="var">Heqe</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "tm_rcons".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_RCons"><span class="id" type="constructor">T_RCons</span></a>... <span class="id" type="tactic">inversion</span> <span class="id" type="var">H7</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>...<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <a name="STLCExtendedRecords.preservation"><span class="id" type="lemma">preservation</span></a> : <span style="font-family: arial;">&forall;</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> <a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <span class="id" type="var">t</span> <span class="id" type="var">T</span>  <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t'</span>  <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.has_type"><span class="id" type="inductive">has_type</span></a> <a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <span class="id" type="var">t'</span> <span class="id" type="var">T</span>.<br/>
<span class="id" type="keyword">Proof</span> <span class="id" type="keyword">with</span> <span class="id" type="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">T</span> <span class="id" type="var">HT</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Theorem:&nbsp;If&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">t'</span></span>,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">t'</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> (@<a class="idref" href="SfLib.html#empty"><span class="id" type="definition">empty</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" type="inductive">ty</span></a>) <span class="id" type="keyword">as</span> <span style="font-family: serif; font-size:85%;">&Gamma;</span>. <span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">HeqGamma</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">t'</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Proof:&nbsp;By&nbsp;induction&nbsp;on&nbsp;the&nbsp;given&nbsp;typing&nbsp;derivation.&nbsp;&nbsp;Many&nbsp;cases&nbsp;are<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contradictory&nbsp;(<span class="inlinecode"><span class="id" type="var">T_Var</span></span>,&nbsp;<span class="inlinecode"><span class="id" type="var">T_Abs</span></span>)&nbsp;or&nbsp;follow&nbsp;directly&nbsp;from&nbsp;the&nbsp;IH<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="inlinecode"><span class="id" type="var">T_RCons</span></span>).&nbsp;&nbsp;We&nbsp;show&nbsp;just&nbsp;the&nbsp;interesting&nbsp;ones.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" type="var">has_type_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">HT</span>) <span class="id" type="var">Case</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t'</span> <span class="id" type="var">HeqGamma</span> <span class="id" type="var">HE</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">HE</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_App".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;the&nbsp;last&nbsp;rule&nbsp;used&nbsp;was&nbsp;<span class="inlinecode"><span class="id" type="var">T_App</span></span>,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">t1</span></span> <span class="inlinecode"><span class="id" type="var">t2</span></span>,&nbsp;and&nbsp;three&nbsp;rules<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;could&nbsp;have&nbsp;been&nbsp;used&nbsp;to&nbsp;show&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">t'</span></span>:&nbsp;<span class="inlinecode"><span class="id" type="var">ST_App1</span></span>,&nbsp;<span class="inlinecode"><span class="id" type="var">ST_App2</span></span>,&nbsp;and&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">ST_AppAbs</span></span>.&nbsp;In&nbsp;the&nbsp;first&nbsp;two&nbsp;cases,&nbsp;the&nbsp;result&nbsp;follows&nbsp;directly&nbsp;from&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;IH.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">HE</span>; <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ST_AppAbs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;For&nbsp;the&nbsp;third&nbsp;case,&nbsp;suppose&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">t1</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">tm_abs</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">T11</span></span> <span class="inlinecode"><span class="id" type="var">t12</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">t2</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">v2</span></span>.&nbsp;&nbsp;We&nbsp;must&nbsp;show&nbsp;that&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="tactic">subst</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">v2</span></span> <span class="inlinecode"><span class="id" type="var">t12</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T2</span></span>.&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;know&nbsp;by&nbsp;assumption&nbsp;that<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">tm_abs</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">T11</span></span> <span class="inlinecode"><span class="id" type="var">t12</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T1</span><span style="font-family: arial;">&rarr;</span><span class="id" type="var">T2</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;by&nbsp;inversion<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">x</span>:<span class="id" type="var">T1</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">t12</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T2</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;have&nbsp;already&nbsp;proven&nbsp;that&nbsp;substitution_preserves_typing&nbsp;and&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span style="font-family: arial;">&#8866;</span></span> <span class="inlinecode"><span class="id" type="var">v2</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="var">T1</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;assumption,&nbsp;so&nbsp;we&nbsp;are&nbsp;done.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.substitution_preserves_typing"><span class="id" type="lemma">substitution_preserves_typing</span></a> <span class="id" type="keyword">with</span> <span class="id" type="var">T1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">HT1</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_Proj".<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;the&nbsp;last&nbsp;rule&nbsp;was&nbsp;<span class="inlinecode"><span class="id" type="var">T_Proj</span></span>,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">tm_proj</span></span> <span class="inlinecode"><span class="id" type="var">t1</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span>.&nbsp;&nbsp;Two&nbsp;rules<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;could&nbsp;have&nbsp;caused&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">t'</span></span>:&nbsp;<span class="inlinecode"><span class="id" type="var">T_Proj1</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" type="var">T_ProjRcd</span></span>.&nbsp;&nbsp;The&nbsp;typing<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;<span class="inlinecode"><span class="id" type="var">t'</span></span>&nbsp;follows&nbsp;from&nbsp;the&nbsp;IH&nbsp;in&nbsp;the&nbsp;former&nbsp;case,&nbsp;so&nbsp;we&nbsp;only<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consider&nbsp;<span class="inlinecode"><span class="id" type="var">T_ProjRcd</span></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;we&nbsp;have&nbsp;that&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span>&nbsp;is&nbsp;a&nbsp;record&nbsp;value.&nbsp;&nbsp;Since&nbsp;rule&nbsp;T_Proj&nbsp;was<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;used,&nbsp;we&nbsp;know&nbsp;<span class="inlinecode"><span class="id" type="var">has_type</span></span> <span class="inlinecode"><span class="id" type="var">empty</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span class="id" type="var">Tr</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" type="var">ty_lookup</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">Tr</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">Some</span></span>
     <span class="inlinecode"><span class="id" type="var">Ti</span></span>&nbsp;for&nbsp;some&nbsp;<span class="inlinecode"><span class="id" type="var">i</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" type="var">Tr</span></span>.&nbsp;&nbsp;We&nbsp;may&nbsp;therefore&nbsp;apply&nbsp;lemma<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" type="var">lookup_field_in_value</span></span>&nbsp;to&nbsp;find&nbsp;the&nbsp;record&nbsp;element&nbsp;this<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;projection&nbsp;steps&nbsp;to.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="Records.html#STLCExtendedRecords.lookup_field_in_value"><span class="id" type="lemma">lookup_field_in_value</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span> <span class="id" type="var">HT</span> <span class="id" type="var">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [<span class="id" type="var">vi</span> [<span class="id" type="var">Hget</span> <span class="id" type="var">Htyp</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H4</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hget</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">Hget</span>. <span class="id" type="tactic">subst</span>...<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "T_RCons".<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;If&nbsp;the&nbsp;last&nbsp;rule&nbsp;was&nbsp;<span class="inlinecode"><span class="id" type="var">T_RCons</span></span>,&nbsp;then&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">tm_rcons</span></span> <span class="inlinecode"><span class="id" type="var">i</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span class="id" type="var">tr</span></span>&nbsp;for<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;some&nbsp;<span class="inlinecode"><span class="id" type="var">i</span></span>,&nbsp;<span class="inlinecode"><span class="id" type="var">t</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" type="var">tr</span></span>&nbsp;such&nbsp;that&nbsp;<span class="inlinecode"><span class="id" type="var">record_tm</span></span> <span class="inlinecode"><span class="id" type="var">tr</span></span>.&nbsp;&nbsp;If&nbsp;the&nbsp;step&nbsp;is<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;<span class="inlinecode"><span class="id" type="var">ST_Rcd_Head</span></span>,&nbsp;the&nbsp;result&nbsp;is&nbsp;immediate&nbsp;by&nbsp;the&nbsp;IH.&nbsp;&nbsp;If&nbsp;the&nbsp;step<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;by&nbsp;<span class="inlinecode"><span class="id" type="var">ST_Rcd_Tail</span></span>,&nbsp;<span class="inlinecode"><span class="id" type="var">tr</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">tr2'</span></span>&nbsp;for&nbsp;some&nbsp;<span class="inlinecode"><span class="id" type="var">tr2'</span></span>&nbsp;and&nbsp;we&nbsp;must&nbsp;also<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use&nbsp;lemma&nbsp;<span class="inlinecode"><span class="id" type="var">step_preserves_record_tm</span></span>&nbsp;to&nbsp;show&nbsp;<span class="inlinecode"><span class="id" type="var">record_tm</span></span> <span class="inlinecode"><span class="id" type="var">tr2'</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_RCons"><span class="id" type="constructor">T_RCons</span></a>... <span class="id" type="tactic">eapply</span> <a class="idref" href="Records.html#STLCExtendedRecords.step_preserves_record_tm"><span class="id" type="lemma">step_preserves_record_tm</span></a>...<br/>
<span class="id" type="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">End</span> <a class="idref" href="Records.html#"><span class="id" type="module">STLCExtendedRecords</span></a>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>